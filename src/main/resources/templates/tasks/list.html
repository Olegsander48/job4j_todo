<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{fragments/header :: header}"></head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<div class="container">
    <div class="row">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Описание</th>
                <th scope="col">Дата публикации задачи</th>
                <th scope="col">Статус</th>
                <th scope="col">Автор задачи</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="task: ${tasks}" th:attr="data-status=${task.done}">
                <td th:text="${task.id}"></td>
                <td>
                    <a th:text="${task.description}"
                       th:href="@{/tasks/{taskId}(taskId=${task.id})}">
                    </a>
                </td>
                <td th:text="${task.getFormattedCreationDate()}"></td>
                <td th:if="${task.done}">Выполнено</td>
                <td th:unless="${task.done}">В работе</td>
                <td th:text="${task.user.getName()}"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="row">
        <div class="col-6">
            <div class="row">
                <div class="col-3"></div>
                <div class="col-5">
                    <a class="btn btn-info w-100"
                       th:href="@{/tasks/create}">Создать заявку</a></div>
            </div>
        </div>
        <div class="dropdown col-6 row">
            <div class="col-3"></div>
            <div class="col-5">
                <button id="filterDropdownBtn" class="btn btn-secondary dropdown-toggle" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    Фильтрация: все
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" onclick="setFilter('all', 'все')" href="#">Все</a></li>
                    <li><a class="dropdown-item" onclick="setFilter('false', 'в работе')" href="#">В работе</a></li>
                    <li><a class="dropdown-item" onclick="setFilter('true', 'выполнено')" href="#">Выполнено</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<footer th:insert="~{fragments/footer :: footer}"></footer>

<script>
    function setFilter(status, label) {
        document.getElementById('filterDropdownBtn').textContent = 'Фильтрация: ' + label;

        const rows = document.querySelectorAll('tr[data-status]');
        rows.forEach(row => {
            if (status === 'all' || row.dataset.status === status) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }
</script>

</body>
</html>